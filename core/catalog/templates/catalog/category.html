{% load static %}

{% block title %}Категории – TastyCo{% endblock %}

{% block content %}
<!-- Header-Bereich -->
<section class="img" style="
    background-image: url({% static 'images/bg_3.jpg' %});
    height: 4cm;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
">
  <div class="container">
    <div class="row justify-content-center align-items-center">
      <div class="col-md-12 text-center ftco-animate p-0 m-0">
        <h1 class="mb-1 bread text-white">Наше меню</h1>
        <p class="breadcrumbs mb-0 text-white">
          <span><a href="/" class="text-white">Главная</a></span> <span class="text-white">Категории</span>
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Kategorie-Tabs -->
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12 text-center">
      <div class="nav nav-pills justify-content-center mb-4" id="v-pills-tab" role="tablist">
        {% for category in categories %}
          <a class="nav-link {% if forloop.first %}active{% endif %}"
             id="v-pills-{{ category.id }}-tab"
             data-toggle="pill"
             href="#v-pills-{{ category.id }}"
             role="tab"
             aria-selected="{% if forloop.first %}true{% else %}false{% endif %}">
            {{ category.name }}
          </a>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="tab-content" id="v-pills-tabContent">
        {% for category in categories %}
          <div class="tab-pane fade {% if forloop.first %}show active{% endif %}"
               id="v-pills-{{ category.id }}"
               role="tabpanel">
            <div class="row">
              {% for product in category.product_set.all %}
                <div class="col-md-4 mb-4">
                  <div class="menu-wrap text-center">

                    <!-- DEBUG-Anzeige: Bild-URL -->
                    <p style="color: green; font-size: 12px;">
                      Bild-URL: {{ product.productimage_set.first.image.url }}
                    </p>

                    <!-- Bildanzeige -->
                    {% with product.productimage_set.first as image %}
                      {% if image %}
                        <img src="{{ image.image.url }}"
                             alt="{{ product.name }}"
                             style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px;">
                      {% else %}
                        <img src="{% static 'images/placeholder.jpg' %}"
                             alt="Kein Bild"
                             style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px;">
                      {% endif %}
                    {% endwith %}

                    <!-- Produktinfos -->
                    <div class="text mt-3">
                      <h3><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></h3>
                      <p>{{ product.description|truncatewords:15 }}</p>
                      <p class="price"><span>${{ product.price }}</span></p>
                      <p><a href="#" class="btn btn-white btn-outline-white">В корзину</a></p>
                    </div>
                  </div>
                </div>
              {% empty %}
                <p class="text-muted text-center">Нет продуктов в категории "{{ category.name }}".</p>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
